{% extends "PhysioWat/base.html" %}
{% load static %}
{% load highcharts_tags %}
{% block app_specific_css %}
    {% load bootstrap3 %}
{% endblock %}

{% block container %}
    <!--Creating the divs to dispay the name of the step-->
    <br><br><br>
    <div class="form-cnt">

        <div width="100%" height="100%"
             style="border-radius:10px 10px 10px 10px; border: 2px solid #6699FF; padding:0%; postion:abolute; height:4em;"
             class="col-md-12">

            <!--step 1-->
            <!--style="	border-top-left-radius:10px ; border-bottom-left-radius:10px ;background-color:#6699FF; color:white; border-right:2px solid #6699FF; height:100%;text-align: center; padding-top:3.8%"-->
            <div id="div_step_1" align="left" width="33%" class="col-md-4"
                 style="border-top-left-radius:10px ; border-bottom-left-radius:10px ;background-color:#F6F6F6; color:black; border-right:2px solid #6699FF; height:100%;text-align: center; padding-top:3.8%">
                Step 1
            </div>
            <!--step 2-->
            <!--style="border-right:2px solid #6699FF; height:100%; text-align: center; padding-top:3.8%" -->
            <div id="div_step_2" align="center" width="33%" class="col-md-4"
                 style="background-color:#F6F6F6; color:black; border-right:2px solid #6699FF; height:100%;text-align: center; padding-top:3.8%">
                Step 2
            </div>
            <!--step 3-->
            <!--style="	border-top-right-radius:10px ; border-bottom-right-radius:10px ;text-align: center;height:100%; padding-top:3.8%"-->
            <div id="div_step_3" align="right" width="33%" height="100%" class="col-md-4"
                 style="background-color:#6699FF; color:white;border-top-right-radius:10px ; border-bottom-right-radius:10px ;text-align: center;height:100%; padding-top:3.8%">
                Step 3
            </div>
        </div>
    </div>
    <!--end steps-->
    <br>
    <div style="width:90%; margin:0 auto;">
        <div class="content row">
            <br><br><br><br>

            <div class="graphs col-md-8">
                <style>
                    .highcharts-input-group {
                        display: none;
                    }

                    .highcharts-range-selector-buttons {
                        display: none;
                    }
                </style>
                <div class="processed-signal row">
                    <div id="processed-signal"></div>
                    <!-- THIS IS ANOTHER DIV FOR ANOTHER GRAPH, IT DOES NOT CONTAIN ANITHING NOW -->
                </div>
                <hr>
                <div class="temporary-processing row">
                    <div id="temporary-processing"></div>
                    <!-- THIS IS THE DIV CONTAINIG THE GRAPH -->
                </div>
            </div>

            <div class="algorithms col-md-4" style="margin-top: 40px; padding-left:20px">
                <ul class="nav nav-tabs" id="setting_nav">
                    {% for k,v in forms.items %}
                        {% if v %}
                            <li role="presentation" class="active"><a href="#" id="nav_id_{{ k }}">{{ k }}</a></li>
                        {% endif %}
                    {% endfor %}
                </ul>


                <form action="#" name="preproc" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {% for k,v in forms.items %}

                        <!-- in the end, this contains a form. wich tag is better? div, what?-->
                        {% if v %}
                            {% for kv,vv in v.items %}
                                <div id="div_id_{{ k }}" style="display:none">
                                    <br>
                                    {% bootstrap_form vv %}
                                    <br>
                                    <br>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}

                    <div>
                        {% buttons %}
                            <button type="submit" id="select_submit" class="btn btn-success">Process Data</button>
                            <button type="reset" class="btn btn-danger">Reset</button>
                            <button type="button" class="btn btn-active" onClick="show()">ShowAll</button>
                        {% endbuttons %}
                    </div>

            </div>

            </form>

            <p align="center">Signals</p>

            options list:
            <div id="options">
                <form onsubmit="show_graph()" id="options_form">
                    <fieldset>
                        <ul>
                            {% for i in opt_list %}
                                <li><input type="checkbox" name="{{ i }}" value="{{ i }}" id="{{ i }}"/>{{ i }}</li>
                            {% endfor %}
                        </ul>
                        {% buttons %}
                            <button type="submit" id="select_submit" class="btn btn-success">Update Graph</button>
                        {% endbuttons %}
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
    </div>

{% endblock %}

{% block app_specific_js %}

    {% highcharts_js 1 1 0 0 %}

    <script>
        "use strict";
        var formlist = [];

        $(document).ready(function () {
            var i = 0;
            {% for k,v in forms.items %}
                formlist.push("{{ k }}");
            {% endfor %}

//DEFINE WHAT HAPPENS ON CLICK EVENT
            for (var i = 0; i < formlist.length; i++) {
                var nav_id = "#nav_id_" + formlist[i];  //THIS IS THE ID OF THE BUTTON OF THE NAV
                var div_id = "#div_id_" + formlist[i]; //THIS IS THE ID OF THE IDDEN DIV WHERE THE FORM IS RENDERED

                var eventData = {'divid': div_id};

                $(nav_id).attr("target", div_id);

                $(nav_id).click(function (e) {
                    e.preventDefault();

                    hide();

                    $(this.getAttribute("target")).show();
                });
            }
        });

        function hide() {
            for (var i = 0; i < formlist.length; i++) {
                var $target = $("#div_id_" + formlist[i]);
                $target.hide();
            }
        }

        function show() {
            for (var i = 0; i < formlist.length; i++) {
                var $target = $("#div_id_" + formlist[i]);
                $target.show();
            }
        }

        hide();

        var global_data = NaN;

        $.getJSON("{% url 'chart_getdata' id_num elab %}", function (data) {
            global_data = data;
            show_graph();
        });


        function show_graph() {
            var allVals = [];
            $('#options :input:checked').each(function (i, elem) {
                allVals.push(elem.value);
            });
            var dataTmp = {};
            var tmp, tmp2;
            for (tmp in global_data) {
                if (tmp != "series") {
                    dataTmp = $.extend(dataTmp, {tmp: global_data[tmp]});
                } else {
                    dataTmp["series"] = [];
                    for (tmp2 in global_data["series"]) {
                        if ($.inArray(global_data["series"][tmp2].name, allVals) != -1) {
                            dataTmp["series"].push(
                                    {"name": global_data["series"][tmp2].name, "data": global_data["series"][tmp2].data}
                            );
                        }
                    }
                }
            }
            $('#temporary-processing').highcharts('StockChart', dataTmp);
        }

        //prevent page from reload on submit
        $('#options_form').on('submit', function (e) {
            e.preventDefault();
        });
    </script>

{% endblock app_specific_js %}



